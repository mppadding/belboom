<?php

use Illuminate\Foundation\Testing\WithoutMiddleware;
use Illuminate\Foundation\Testing\DatabaseMigrations;
use Illuminate\Foundation\Testing\DatabaseTransactions;

class GroepenTest extends TestCase
{
    
    use DatabaseTransactions;
    
    /**
     * Test if an user can create a group
     * 
     * @return void
     */
    public function testCreate()
    {
        $this->actingAs( factory('App\User')->create() );
        
        $this->visit('/groepen/create')
             ->seePageIs('/groepen/create');
             
        $contact = factory('App\Contact')->create(['name' => 'Test Contact']);
        
        $this->submitForm([
            'name' => 'Test Groep',
            'contacts' => $contact->id
        ]);
        
        $this->seeInDatabase('groups', ['name' => 'Test Groep']);
    }
    
    /**
     * Test if an user can read a group
     * 
     * @return void
     */
    public function testRead()
    {
        $this->actingAs( factory('App\User')->create() );
        
        $contact = factory('App\Group')->create(['name' => 'Test Groep']);
        $this->seeInDatabase('groups', ['name' => 'Test Groep']);
        
        $this->visit('/groepen')
             ->see('Test Groep');
    }
    
    /**
     * Test if an user can update a role
     * 
     * @return void
     */
    public function testUpdate()
    {
        $this->actingAs( factory('App\User')->create() );
        
        $group = factory('App\Group')->create(['name' => 'Test Groep']);
        
        $this->visit('/groepen/' . $group->id . '/edit');
        
        $this->submitForm([
            'name' => 'Test Groep 2',
            'contacts' => ''
        ]);
        
        $this->seeInDatabase('groups', ['name' => 'Test Groep 2']);
    }
    
    /**
     * Test if an user can update a role
     * 
     * @return void
     */
    public function testDelete()
    {
        $this->actingAs( factory('App\User')->create() );
        
        $group = factory('App\Group')->create(['name' => 'Test Groep']);
        
        $this->visit('/groepen');
        
        $this->press('delete_' . $group->id)
             ->missingFromDatabase('roles', ['name' => 'Test Functie']);
    }
}